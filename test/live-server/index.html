<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Mocha Tests</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="lib/mocha.css" />

    <script type="importmap">
    {
      "imports": {
        "@typhonjs-plugin/manager": "./PluginManager.js",
        "@typhonjs-util/test": "./plugin/TestInputMap.js"
      }
    }
    </script>
</head>
<body>
<div id="mocha"></div>

<script src="lib/mocha.js"></script>

<script type="module">
   import chai              from './lib/chai.js';
   import chaiAsPromised    from './lib/chai-as-promised.js';

   import * as Module       from './PluginManager.js';

   import TestSuiteRunner   from './TestSuiteRunner.js';

   import mochaConsoleLog   from './lib/mochaConsoleLog.js';

   import PluginTest          from './test/fixture/plugins/PluginTest.js';
   import PluginTestNoName2   from './test/fixture/plugins/PluginTestNoName2.js';
   import PluginTestAsync     from './test/fixture/plugins/PluginTestAsync.js';
   import PluginTestSync      from './test/fixture/plugins/PluginTestSync.js';

   chai.use(chaiAsPromised);

   const port = window.location.port;

   const moduleURL = new URL(`http://localhost:${port}/test/fixture/formats/esm/namedExport.js`);
   const moduleURLString = moduleURL.toString();

   const data = {
      suitePrefix: 'browser/PluginManager',
      moduleURL,
      moduleURLString,
      isBrowser: true,

      plugins: {
         PluginTest,
         PluginTestNoName2,
         PluginTestAsync,
         PluginTestSync
      },

      pluginFormats: [
         { name: 'ESM-InstancePlugin', target: './test/fixture/formats/esm/InstancePlugin.js', type: 'import-path' },
         { name: 'ESM-StaticPlugin', target: './test/fixture/formats/esm/StaticPlugin.js', type: 'import-path' },
         { name: 'ESM-namedExport', target: './test/fixture/formats/esm/namedExport.js', type: 'import-path' },
         { name: 'ESM-URL-namedExport', target: moduleURL, type: 'import-url' },
         { name: 'ESM-file-URL-namedExport', target: moduleURLString, type: 'import-url' }
      ]
   };

   mocha.setup({
      timeout: '6000',
      ui: 'bdd'
   });

   mocha.checkLeaks();

   TestSuiteRunner.run(Module, data, chai);

   mochaConsoleLog(mocha.run());
</script>
</body>
</html>
